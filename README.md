# Telegram Bot —Å –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ü–∞–º—è—Ç—å—é

–£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç Telegram-–±–æ—Ç–∞ –Ω–∞ Python 3.11+ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π OpenAI API –∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é:
- **–ö–æ—Ä–æ—Ç–∫–∞—è –ø–∞–º—è—Ç—å** (short-term): –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–∏–∞–ª–æ–≥–∞
- **–î–ª–∏–Ω–Ω–∞—è –ø–∞–º—è—Ç—å** (long-term): –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å RAG –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **RAG-—Ä–µ–∂–∏–º**: –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- **–î–∏–∞–ª–æ–≥–æ–≤—ã–π —Ä–µ–∂–∏–º**: –û–±—ã—á–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å –ø–∞–º—è—Ç—å—é –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–æ–º–ø–∞–Ω–∏–∏
- **Graceful error handling**: –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
src/
‚îú‚îÄ‚îÄ main.py          - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, Telegram bot handlers
‚îú‚îÄ‚îÄ config.py        - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ .env
‚îú‚îÄ‚îÄ memory_short.py  - –ö–æ—Ä–æ—Ç–∫–∞—è –ø–∞–º—è—Ç—å (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)
‚îú‚îÄ‚îÄ vectordb.py      - –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î –Ω–∞ SQLite + cosine similarity
‚îú‚îÄ‚îÄ rag.py           - Chunking, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è, retrieval
‚îî‚îÄ‚îÄ llm.py           - –û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ OpenAI API
```

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

–ü—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

1. **Retrieval**: –ü–æ–ª—É—á–µ–Ω–∏–µ top-K (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3) –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î
2. **Decision**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª—É—á—à–µ–≥–æ score –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä–æ–≥—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.70)
3. **Response**:
   - **–ï—Å–ª–∏ score ‚â• threshold** ‚Üí **RAG-—Ä–µ–∂–∏–º**:
     - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–æ–º–ø–∞–Ω–∏–∏
     - –°—Ç—Ä–æ–≥–∏–π system prompt: –∑–∞–ø—Ä–µ—Ç –Ω–∞ –≤—ã–¥—É–º–∫–∏
     - –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ ‚Üí —Å–æ–æ–±—â–∞–µ—Ç –æ–± —ç—Ç–æ–º
   - **–ï—Å–ª–∏ score < threshold** ‚Üí **LLM —Å –∫–æ—Ä–æ—Ç–∫–æ–π –ø–∞–º—è—Ç—å—é**:
     - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 —Å–æ–æ–±—â–µ–Ω–∏–π
     - –û–±—ã—á–Ω—ã–π –¥–∏–∞–ª–æ–≥–æ–≤—ã–π —Ä–µ–∂–∏–º

### –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ SQLite** (`data/memory.db`):
- `chunks` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
- `embeddings` - –≤–µ–∫—Ç–æ—Ä—ã (BLOB float32)
- `meta` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (hash —Ñ–∞–π–ª–∞ company.txt)

**–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**:
1. –ß—Ç–µ–Ω–∏–µ `company.txt`
2. –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏ (100-400 —Å–∏–º–≤–æ–ª–æ–≤, –ø–æ –∞–±–∑–∞—Ü–∞–º)
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings —á–µ—Ä–µ–∑ OpenAI
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ SQLite
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ SHA256 hash —Ñ–∞–π–ª–∞

**–ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ë–î
- –ò–∑–º–µ–Ω–µ–Ω–∏–∏ hash —Ñ–∞–π–ª–∞ `company.txt`

**–ü–æ–∏—Å–∫**:
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ cosine similarity –≤ Python (numpy)
- –í–æ–∑–≤—Ä–∞—Ç top-K –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ—Ö–æ–∂–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Python 3.11 –∏–ª–∏ 3.12** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3.12)
  - ‚ö†Ô∏è Python 3.14 –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (–Ω–µ—Ç wheels –¥–ª—è aiogram –∏ –¥—Ä—É–≥–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
  - Python 3.13 –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å
- Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/BotFather))
- OpenAI API Key (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ [platform.openai.com](https://platform.openai.com))

### –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

#### Windows (PowerShell)

```powershell
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ —Ä–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤
cd path\to\memory_bot

# 2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
py -3.12 -m venv venv

# 3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
.\venv\Scripts\Activate.ps1

# 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
# –î–ª—è Python 3.11 –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: pip install -r requirements-py311.txt

# 5. –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª –∏–∑ –ø—Ä–∏–º–µ—Ä–∞
Copy-Item env_example.txt .env

# 6. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª (–¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ —Ç–æ–∫–µ–Ω—ã)
notepad .env
```

#### macOS / Linux (Bash)

```bash
# 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd path/to/memory_bot

# 2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv

# 3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
# –î–ª—è Python 3.11 –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: pip install -r requirements-py311.txt

# 5. –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª –∏–∑ –ø—Ä–∏–º–µ—Ä–∞
cp env_example.txt .env

# 6. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª (–¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ —Ç–æ–∫–µ–Ω—ã)
nano .env  # –∏–ª–∏ vim, –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:

```env
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_BotFather
OPENAI_API_KEY=–≤–∞—à_–∫–ª—é—á_OpenAI
```

–û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

```env
# –ú–æ–¥–µ–ª–∏ OpenAI
OPENAI_CHAT_MODEL=gpt-4o          # –∏–ª–∏ gpt-4-turbo, gpt-3.5-turbo
OPENAI_EMBED_MODEL=text-embedding-3-small

# –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
DB_PATH=data/memory.db
COMPANY_TXT_PATH=data/company.txt

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã RAG
TOP_K=3                            # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –¥–ª—è retrieval
RAG_THRESHOLD=0.70                 # –ü–æ—Ä–æ–≥ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤ RAG-—Ä–µ–∂–∏–º

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
DEBUG=0                            # 1 –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–ª–∞–¥–∫–∏
LOG_LEVEL=INFO                     # DEBUG, INFO, WARNING, ERROR
```

## üöÄ –ó–∞–ø—É—Å–∫

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `.env` —Ñ–∞–π–ª–∞:

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ
python -m src.main
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ `data/company.txt`
2. –°–æ–∑–¥–∞—Å—Ç –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î `data/memory.db`
3. –ü—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–∑–∞–π–º—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥)
4. –ù–∞—á–Ω—ë—Ç –æ–∂–∏–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram

–í –ª–æ–≥–∞—Ö –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
INFO - Starting bot initialization...
INFO - Components initialized
INFO - Indexing company data...
INFO - Split into N chunks
INFO - Generating embeddings...
INFO - Indexed N chunks into database
INFO - Bot is ready!
INFO - Starting polling...
```

## üí¨ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `/help` - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- `/reset` - –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ (–∫–æ—Ä–æ—Ç–∫—É—é –ø–∞–º—è—Ç—å)

### –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤

#### –í–æ–ø—Ä–æ—Å—ã –¥–ª—è RAG-—Ä–µ–∂–∏–º–∞ (–≤—ã—Å–æ–∫–∏–π score, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–∞ –∫–æ–º–ø–∞–Ω–∏–∏):

- "–ö–∞–∫–∏–µ —É –≤–∞—Å —Ç–∞—Ä–∏—Ñ—ã?"
- "–ö–∞–∫ —è –º–æ–≥—É –≤–µ—Ä–Ω—É—Ç—å –¥–µ–Ω—å–≥–∏?"
- "–ö–∞–∫–∏–µ –≤–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã?"
- "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –ø—Ä–æ–¥—É–∫—Ç CRM-—Å–∏—Å—Ç–µ–º–∞"
- "–ö–∞–∫–æ–π –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã?"
- "–ß—Ç–æ —Ç–∞–∫–æ–µ SLA –Ω–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ?"
- "–ö–∞–∫–∏–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã?"

#### –í–æ–ø—Ä–æ—Å—ã –¥–ª—è LLM-—Ä–µ–∂–∏–º–∞ (–Ω–∏–∑–∫–∏–π score, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥):

- "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?"
- "–ß—Ç–æ —Ç—ã –¥—É–º–∞–µ—à—å –æ –ø–æ–≥–æ–¥–µ?"
- "–†–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç"
- "–ü–æ–º–æ–≥–∏ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ"
- "–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –ø–∏—Ü—Ü—É?"

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

**RAG-—Ä–µ–∂–∏–º**:
- –ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç —Å—Ç—Ä–æ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `company.txt`
- –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç ‚Üí —Å–∫–∞–∂–µ—Ç: "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É."
- –í –ª–æ–≥–∞—Ö: `INFO - Using RAG mode`

**LLM-—Ä–µ–∂–∏–º**:
- –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ú–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ –æ–±—ã—á–Ω—ã–π –¥–∏–∞–ª–æ–≥
- –í –ª–æ–≥–∞—Ö: `INFO - Using LLM_WITH_CONTEXT mode`

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏

–ß—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏:

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `data/company.txt`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
3. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (–ø–æ hash) –∏ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ

**–§–æ—Ä–º–∞—Ç company.txt**:
- –¢–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ –∞–±–∑–∞—Ü–∞–º (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–≤–æ–π–Ω—ã–º –ø–µ—Ä–µ–Ω–æ—Å–æ–º —Å—Ç—Ä–æ–∫–∏)
- –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∞–±–∑–∞—Ü–µ–≤: 100-500 —Å–∏–º–≤–æ–ª–æ–≤
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (—Å–ø–∏—Å–∫–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Ç.–¥.)

## üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞ RAG (RAG_THRESHOLD)

–ü–∞—Ä–∞–º–µ—Ç—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RAG-—Ä–µ–∂–∏–º:

- **0.78** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- **0.85** - —Å—Ç—Ä–æ–∂–µ, RAG —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—á–µ–Ω—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- **0.70** - –º—è–≥—á–µ, RAG –¥–ª—è –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–æ–≥–æ –∫—Ä—É–≥–∞ –≤–æ–ø—Ä–æ—Å–æ–≤

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ (TOP_K)

- **3** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤
- **5** - –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –Ω–æ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —à—É–º
- **1** - —Ç–æ–ª—å–∫–æ —Å–∞–º—ã–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ OpenAI

**–î–ª—è —á–∞—Ç–æ–≤** (OPENAI_CHAT_MODEL):
- `gpt-4o` - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏)
- `gpt-4-turbo` - –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- `gpt-3.5-turbo` - –±—ã—Å—Ç—Ä–µ–µ –∏ –¥–µ—à–µ–≤–ª–µ

**–î–ª—è embeddings** (OPENAI_EMBED_MODEL):
- `text-embedding-3-small` - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–±—ã—Å—Ç—Ä–æ, –¥–µ—à–µ–≤–æ, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ)
- `text-embedding-3-large` - –≤—ã—à–µ –∫–∞—á–µ—Å—Ç–≤–æ, –Ω–æ –¥–æ—Ä–æ–∂–µ
- `text-embedding-ada-002` - legacy –º–æ–¥–µ–ª—å

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:

```
INFO - User 12345: –ö–∞–∫–∏–µ —É –≤–∞—Å —Ç–∞—Ä–∏—Ñ—ã?
INFO - Best similarity score: 0.8523, threshold: 0.78
INFO - Using RAG mode
INFO - Response mode: RAG, length: 245
```

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ `.env`:
```env
DEBUG=1
LOG_LEVEL=DEBUG
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- **–£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç**: –î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤ `company.txt` –ø—Ä–∏–º–µ—Ä–Ω—ã–µ
- **–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫**: –ü—Ä–æ–µ–∫—Ç –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è production deployment
- **–°—Ç–æ–∏–º–æ—Å—Ç—å API**: OpenAI API –ø–ª–∞—Ç–Ω—ã–π, —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞ platform.openai.com
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª –≤ Git (–æ–Ω –≤ `.gitignore`)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —á–∞–Ω–∫–æ–≤ (>1000) –ø–æ–∏—Å–∫ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å—Å—è

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ numpy / –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: Python 3.14 —Å–ª–∏—à–∫–æ–º –Ω–æ–≤—ã–π, –Ω–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö wheels –¥–ª—è –º–Ω–æ–≥–∏—Ö –ø–∞–∫–µ—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ**: 
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Python 3.12 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –∏–ª–∏ 3.11
2. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π venv: `Remove-Item -Recurse -Force venv`
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π: `py -3.12 -m venv venv`
4. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: `pip install -r requirements.txt`

### –û—à–∏–±–∫–∞ "Client.__init__() got an unexpected keyword argument 'proxies'"

**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è openai (1.54.4) –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º httpx.

**–†–µ—à–µ–Ω–∏–µ**: 
```powershell
pip install --upgrade openai
```

### –û—à–∏–±–∫–∞ "TELEGRAM_BOT_TOKEN is not set"

–†–µ—à–µ–Ω–∏–µ: –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

### –û—à–∏–±–∫–∞ "Company data file not found"

–†–µ—à–µ–Ω–∏–µ: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `data/company.txt` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### –û—à–∏–±–∫–∞ OpenAI API (401 Unauthorized)

–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å OPENAI_API_KEY –≤ `.env`

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –≤ Telegram

–†–µ—à–µ–Ω–∏–µ:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "Bot is ready!"
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ `/start` –∫–æ–º–∞–Ω–¥—É

### –ë–æ—Ç –≤—Å–µ–≥–¥–∞ –≤—ã–±–∏—Ä–∞–µ—Ç LLM-—Ä–µ–∂–∏–º –≤–º–µ—Å—Ç–æ RAG

–†–µ—à–µ–Ω–∏–µ:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `company.txt` –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω (—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏)
2. –ü–æ—Ä–æ–≥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–∂–µ 0.70, –Ω–æ –º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 0.65
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–ª–æ—Å—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–∞–Ω–∫–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~11, –∞ –Ω–µ 4)
4. –ï—Å–ª–∏ –º–∞–ª–æ —á–∞–Ω–∫–æ–≤ - —É–¥–∞–ª–∏—Ç–µ `data/memory.db` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
5. –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –±–ª–∏–∑–∫–∏–µ –∫ —Ç–µ–∫—Å—Ç—É –≤ company.txt

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
memory_bot/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py          # Telegram bot, handlers
‚îÇ   ‚îú‚îÄ‚îÄ config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ memory_short.py  # –ö–æ—Ä–æ—Ç–∫–∞—è –ø–∞–º—è—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ vectordb.py      # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î (SQLite)
‚îÇ   ‚îú‚îÄ‚îÄ llm.py           # OpenAI API wrapper
‚îÇ   ‚îî‚îÄ‚îÄ rag.py           # RAG –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ company.txt      # –î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
‚îÇ   ‚îî‚îÄ‚îÄ memory.db        # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
‚îú‚îÄ‚îÄ .env                 # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
‚îú‚îÄ‚îÄ env_example.txt      # –ü—Ä–∏–º–µ—Ä .env
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

## üîÑ –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ:

```bash
# –£–¥–∞–ª–∏—Ç–µ –ë–î
rm data/memory.db  # Linux/macOS
del data\memory.db  # Windows

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
python -m src.main
```

## üìö –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `aiogram==3.13.1` - Telegram Bot API framework
- `openai>=1.54.4` - OpenAI API client (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2.15.0+)
- `python-dotenv==1.0.1` - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ .env
- `numpy>=2.0.0` - –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (cosine similarity, –¥–ª—è Python 3.12+)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–ª—è Python 3.11 –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `numpy>=1.24.0,<2.0.0` –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–µ—Ä—Å–∏–µ–π 2.x.

–ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ stdlib `sqlite3` –¥–ª—è –ë–î.

## üéì –ß—Ç–æ –º–æ–∂–Ω–æ –∏–∑—É—á–∏—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ

- –†–∞–±–æ—Ç–∞ —Å Telegram Bot API —á–µ—Ä–µ–∑ aiogram v3
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI API (chat completions, embeddings)
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è RAG (Retrieval-Augmented Generation)
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Å cosine similarity
- –†–∞–±–æ—Ç–∞ —Å SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è embeddings
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –≤ —á–∞—Ç-–±–æ—Ç–∞—Ö
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Python
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 19.01.2026  
**Python**: 3.11+  
**–°—Ç–∞—Ç—É—Å**: –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç (–Ω–µ –¥–ª—è production)

